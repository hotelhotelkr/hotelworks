# 🏗️ HotelWorks 전체 시스템 아키텍처

## 📊 전체 시스템 구조도

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         개발자 (개발 환경)                                  │
│                                                                           │
│  ┌──────────────┐                                                        │
│  │  로컬 PC     │                                                        │
│  │  (개발)      │                                                        │
│  └──────┬───────┘                                                        │
│         │                                                                 │
│         │ git push                                                       │
│         │                                                                 │
└─────────┼───────────────────────────────────────────────────────────────┘
          │
          │
          ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                          GitHub (버전 관리)                                │
│                                                                           │
│  ┌──────────────────────────────────────────────────────────────┐     │
│  │  Repository: hotelhotelkr/hotelworks                          │     │
│  │                                                               │     │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐       │     │
│  │  │  Frontend    │  │  Backend     │  │  Config      │       │     │
│  │  │  (React)     │  │  (Node.js)   │  │  Files       │       │     │
│  │  │              │  │              │  │              │       │     │
│  │  │  - App.tsx   │  │  - server.js │  │  - render.yaml│      │     │
│  │  │  - Components│  │  - routes.js │  │  - package.json│    │     │
│  │  │  - Types     │  │  - models    │  │  - .env       │      │     │
│  │  └──────────────┘  └──────────────┘  └──────────────┘       │     │
│  └──────────────────────────────────────────────────────────────┘     │
│                                                                           │
│  Branch: main                                                            │
│  Auto Deploy: ✅ (Vercel, Render)                                        │
└─────────────────────────────────────────────────────────────────────────┘
          │
          │
          ├─────────────────────────────────┬─────────────────────────────┐
          │                                 │                             │
          │                                 │                             │
          ▼                                 ▼                             ▼
┌─────────────────────┐        ┌─────────────────────┐      ┌─────────────────────┐
│   Vercel            │        │   Render            │      │   Supabase          │
│   (Frontend)        │        │   (Backend)         │      │   (Database)        │
│                     │        │                     │      │                     │
│  ┌──────────────┐   │        │  ┌──────────────┐   │      │  ┌──────────────┐   │
│  │  Build       │   │        │  │  Build       │   │      │  │  PostgreSQL  │   │
│  │  Process     │   │        │  │  Process     │   │      │  │  Database    │   │
│  │              │   │        │  │              │   │      │  │              │   │
│  │  1. npm      │   │        │  │  1. npm      │   │      │  │  - orders    │   │
│  │     install  │   │        │  │     install  │   │      │  │  - memos     │   │
│  │              │   │        │  │              │   │      │  │  - users     │   │
│  │  2. npm      │   │        │  │  2. node     │   │      │  │              │   │
│  │     build    │   │        │  │     server.js│   │      │  │  RLS Policy │   │
│  │              │   │        │  │              │   │      │  │  (보안)      │   │
│  │  3. Deploy   │   │        │  │  3. Deploy   │   │      │  └──────────────┘   │
│  └──────────────┘   │        │  └──────────────┘   │      │         │          │
│         │           │        │         │           │      │         │          │
│         │           │        │         │           │      │         │          │
│         ▼           │        │         ▼           │      │         │          │
│  ┌──────────────┐   │        │  ┌──────────────┐   │      │         │          │
│  │  Production  │   │        │  │  Production  │   │      │         │          │
│  │  Server      │   │        │  │  Server      │   │      │         │          │
│  │              │   │        │  │              │   │      │         │          │
│  │  https://    │   │        │  │  https://    │   │      │         │          │
│  │  hotelworks. │   │        │  │  hotelworks- │   │      │         │          │
│  │  kr          │   │        │  │  backend.    │   │      │         │          │
│  │              │   │        │  │  onrender.   │   │      │         │          │
│  │  (Frontend)  │   │        │  │  com         │   │      │         │          │
│  │              │   │        │  │              │   │      │         │          │
│  │  - React App │   │        │  │  - WebSocket │   │      │         │          │
│  │  - Static    │   │        │  │    Server    │   │      │         │          │
│  │    Files     │   │        │  │  - REST API  │   │      │         │          │
│  └──────────────┘   │        │  │  - Express   │   │      │         │          │
│                     │        │  └──────────────┘   │      │         │          │
└─────────────────────┘        └─────────────────────┘      └─────────┼──────────┘
          │                                 │                            │
          │                                 │                            │
          │                                 │                            │
          │                                 │  API 호출                  │
          │                                 │  (REST + WebSocket)        │
          │                                 └────────────┬───────────────┘
          │                                              │
          │                                              │
          └──────────────────────────────────────────────┘
                            │
                            │
                            ▼
          ┌─────────────────────────────────────────────┐
          │         사용자 기기들 (프로덕션)                │
          │                                               │
          │  ┌──────────┐  ┌──────────┐  ┌──────────┐   │
          │  │   PC     │  │  모바일  │  │  태블릿  │   │
          │  │  브라우저 │  │  브라우저 │  │  브라우저 │   │
          │  └──────────┘  └──────────┘  └──────────┘   │
          │                                               │
          │  모두 같은 서비스에 연결:                      │
          │  - Frontend: hotelworks.kr                   │
          │  - WebSocket: hotelworks-backend.onrender.com│
          └─────────────────────────────────────────────┘
```

---

## 🔄 데이터 흐름도

### 1. 주문 생성 흐름

```
┌─────────────┐
│  사용자 A    │
│  (PC)       │
└──────┬──────┘
       │
       │ 1. 주문 생성 버튼 클릭
       │
       ▼
┌─────────────────────────────────────────────────────────┐
│  Frontend (Vercel - hotelworks.kr)                      │
│                                                         │
│  ┌─────────────────────────────────────────────────┐  │
│  │  App.tsx - handleCreateOrder()                  │  │
│  │                                                 │  │
│  │  1. 주문 객체 생성                               │  │
│  │  2. 로컬 상태 업데이트 (즉시 UI 반영)            │  │
│  │  3. localStorage 저장                          │  │
│  │  4. WebSocket으로 전송                          │  │
│  │     socket.emit('hotelflow_sync', {             │  │
│  │       type: 'NEW_ORDER',                       │  │
│  │       payload: orderData,                      │  │
│  │       senderId: 'u1',                          │  │
│  │       sessionId: 'session_xxx'                 │  │
│  │     })                                          │  │
│  └─────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
       │
       │ WebSocket (wss://hotelworks-backend.onrender.com)
       │
       ▼
┌─────────────────────────────────────────────────────────┐
│  Backend (Render - hotelworks-backend.onrender.com)     │
│                                                         │
│  ┌─────────────────────────────────────────────────┐  │
│  │  server.js - socket.on('hotelflow_sync')        │  │
│  │                                                 │  │
│  │  1. 메시지 수신                                  │  │
│  │  2. 데이터베이스 저장                            │  │
│  │     ┌─────────────────────────────────────┐   │  │
│  │     │  OrderModel.create(orderData)        │   │  │
│  │     │                                     │   │  │
│  │     │  ┌───────────────────────────────┐ │   │  │
│  │     │  │  Supabase API 호출            │ │   │  │
│  │     │  │                               │ │   │  │
│  │     │  │  supabase.from('orders')      │ │   │  │
│  │     │  │    .insert({...})             │ │   │  │
│  │     │  └───────────────────────────────┘ │   │  │
│  │     └─────────────────────────────────────┘   │  │
│  │     │                                         │  │
│  │     │  HTTP/HTTPS                            │  │
│  │     │                                         │  │
│  │     ▼                                         │  │
│  │  ┌─────────────────────────────────────┐   │  │
│  │  │  Supabase Database                   │   │  │
│  │  │  (PostgreSQL)                        │   │  │
│  │  │                                     │   │  │
│  │  │  orders 테이블에 저장                │   │  │
│  │  └─────────────────────────────────────┘   │  │
│  │                                                 │  │
│  │  3. 모든 클라이언트에게 브로드캐스트            │  │
│  │     io.emit('hotelflow_sync', message)        │  │
│  └─────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
       │
       │ WebSocket 브로드캐스트
       │
       ├──────────────┬──────────────┬──────────────┐
       │              │              │              │
       ▼              ▼              ▼              ▼
┌──────────┐   ┌──────────┐   ┌──────────┐   ┌──────────┐
│ 사용자 A  │   │ 사용자 B  │   │ 사용자 C  │   │ 사용자 D  │
│ (PC)     │   │ (모바일)  │   │ (태블릿)  │   │ (PC)     │
│          │   │          │   │          │   │          │
│ 자신의    │   │ 다른 사용자│  │ 다른 사용자│  │ 다른 사용자│
│ 메시지    │   │ 메시지     │  │ 메시지     │  │ 메시지     │
│          │   │          │   │          │   │          │
│ - UI     │   │ - UI     │   │ - UI     │   │ - UI     │
│   업데이트│   │   업데이트│   │   업데이트│   │   업데이트│
│ - 알림   │   │ - 알림   │   │ - 알림   │   │ - 알림   │
│   스킵    │   │   표시    │   │   표시    │   │   표시    │
└──────────┘   └──────────┘   └──────────┘   └──────────┘
```

---

## 🔐 인증 및 보안 흐름

```
┌─────────────┐
│  사용자      │
└──────┬──────┘
       │
       │ 1. 로그인 요청
       │    (username, password)
       │
       ▼
┌─────────────────────────────────────────────────────────┐
│  Frontend (Vercel)                                       │
│                                                         │
│  ┌─────────────────────────────────────────────────┐  │
│  │  App.tsx - handleLogin()                       │  │
│  │                                                 │  │
│  │  1. 로컬 사용자 목록 확인                       │  │
│  │  2. 비밀번호 검증                               │  │
│  │  3. 로그인 상태 설정                            │  │
│  │  4. WebSocket 연결 (이미 연결됨)                 │  │
│  └─────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
       │
       │ (선택적) 사용자 목록 동기화
       │
       ▼
┌─────────────────────────────────────────────────────────┐
│  Backend (Render)                                        │
│                                                         │
│  ┌─────────────────────────────────────────────────┐  │
│  │  routes-users.js                                │  │
│  │                                                 │  │
│  │  GET /api/users                                 │  │
│  │                                                 │  │
│  │  ┌───────────────────────────────────────────┐ │  │
│  │  │  Supabase Query                           │ │  │
│  │  │                                           │ │  │
│  │  │  supabase.from('users')                  │ │  │
│  │  │    .select('*')                          │ │  │
│  │  │                                           │ │  │
│  │  │  → 사용자 목록 반환                        │ │  │
│  │  └───────────────────────────────────────────┘ │  │
│  └─────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
       │
       │
       ▼
┌─────────────────────────────────────────────────────────┐
│  Supabase Database                                      │
│                                                         │
│  ┌─────────────────────────────────────────────────┐  │
│  │  users 테이블                                    │  │
│  │                                                 │  │
│  │  - id                                           │  │
│  │  - username                                     │  │
│  │  - password (해시)                              │  │
│  │  - name                                         │  │
│  │  - dept                                         │  │
│  │  - role                                         │  │
│  │                                                 │  │
│  │  RLS Policy:                                    │  │
│  │  - 서비스 롤 키로만 접근 가능                    │  │
│  └─────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
```

---

## 🔄 배포 흐름도

```
┌─────────────────────────────────────────────────────────┐
│  개발자 (로컬 PC)                                         │
│                                                         │
│  ┌─────────────────────────────────────────────────┐  │
│  │  1. 코드 수정                                    │  │
│  │     - App.tsx                                   │  │
│  │     - server.js                                 │  │
│  │     - 기타 파일                                  │  │
│  │                                                 │  │
│  │  2. Git 커밋                                    │  │
│  │     git add .                                   │  │
│  │     git commit -m "..."                         │  │
│  │                                                 │  │
│  │  3. GitHub 푸시                                 │  │
│  │     git push origin main                        │  │
│  └─────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
       │
       │ git push
       │
       ▼
┌─────────────────────────────────────────────────────────┐
│  GitHub (hotelhotelkr/hotelworks)                       │
│                                                         │
│  ┌─────────────────────────────────────────────────┐  │
│  │  Repository 업데이트                             │  │
│  │                                                 │  │
│  │  - main 브랜치에 새 커밋                        │  │
│  │  - Webhook 트리거                               │  │
│  └─────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
       │
       │ Webhook (자동 배포 트리거)
       │
       ├──────────────────────────────┬──────────────────┐
       │                              │                  │
       ▼                              ▼                  ▼
┌──────────────┐            ┌──────────────┐   ┌──────────────┐
│  Vercel      │            │  Render      │   │  Supabase    │
│  (Frontend)  │            │  (Backend)    │   │  (Database)  │
│              │            │              │   │              │
│  ┌────────┐  │            │  ┌────────┐  │   │  ┌────────┐  │
│  │ 1. Git │  │            │  │ 1. Git │  │   │  │ 수동   │  │
│  │    Pull│  │            │  │    Pull│  │   │  │ 설정   │  │
│  │        │  │            │  │        │  │   │  │        │  │
│  │ 2. npm │  │            │  │ 2. npm │  │   │  │ - 테이블│  │
│  │    install│            │  │    install│   │  │   생성  │  │
│  │        │  │            │  │        │  │   │  │        │  │
│  │ 3. npm │  │            │  │ 3. node│  │   │  │ - RLS  │  │
│  │    build│  │            │  │    server.js│ │  │   정책  │  │
│  │        │  │            │  │        │  │   │  │        │  │
│  │ 4. Deploy│ │            │  │ 4. Deploy│ │   │  │ - 환경 │  │
│  │    to CDN│ │            │  │    to Server││  │  │   변수  │  │
│  └────────┘  │            │  └────────┘  │   │  └────────┘  │
│              │            │              │   │              │
│  ✅ 배포 완료 │            │  ✅ 배포 완료 │   │  ✅ 설정 완료 │
│              │            │              │   │              │
│  https://    │            │  https://    │   │  https://    │
│  hotelworks. │            │  hotelworks- │   │  pnmkclrw... │
│  kr          │            │  backend.    │   │  .supabase.  │
│              │            │  onrender.   │   │  co          │
│              │            │  com         │   │              │
└──────────────┘            └──────────────┘   └──────────────┘
```

---

## 🌐 네트워크 연결 흐름

```
┌─────────────────────────────────────────────────────────┐
│  사용자 기기 (PC/모바일/태블릿)                            │
│                                                         │
│  ┌─────────────────────────────────────────────────┐  │
│  │  브라우저 (Chrome, Safari, Firefox 등)          │  │
│  │                                                 │  │
│  │  1. https://hotelworks.kr 접속                  │  │
│  │     ┌─────────────────────────────────────┐  │  │
│  │     │  DNS 조회                            │  │  │
│  │     │  hotelworks.kr → Vercel IP          │  │  │
│  │     └─────────────────────────────────────┘  │  │
│  │                                                 │  │
│  │  2. React 앱 로드                               │  │
│  │     - HTML, CSS, JavaScript 다운로드           │  │
│  │     - Vite 빌드된 파일                         │  │
│  │                                                 │  │
│  │  3. WebSocket 연결                              │  │
│  │     ┌─────────────────────────────────────┐  │  │
│  │     │  getWebSocketURL()                   │  │  │
│  │     │                                      │  │  │
│  │     │  1순위: VITE_WS_SERVER_URL          │  │  │
│  │     │  2순위: localStorage                │  │  │
│  │     │  3순위: 도메인 기반                  │  │  │
│  │     │                                      │  │  │
│  │     │  → wss://hotelworks-backend.        │  │  │
│  │     │    onrender.com                     │  │  │
│  │     └─────────────────────────────────────┘  │  │
│  │                                                 │  │
│  │  4. Socket.IO 연결                              │  │
│  │     io(wsUrl, {                                │  │
│  │       transports: ['websocket', 'polling']    │  │
│  │     })                                         │  │
│  └─────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
       │                           │
       │ HTTPS                     │ WebSocket (WSS)
       │                           │
       ▼                           ▼
┌──────────────┐          ┌──────────────┐
│  Vercel CDN  │          │  Render      │
│              │          │  Server      │
│  - 정적 파일  │          │              │
│  - React App │          │  - WebSocket │
│              │          │  - REST API  │
│  ✅ 응답     │          │              │
└──────────────┘          │  ✅ 연결     │
                          └──────┬───────┘
                                 │
                                 │ HTTP/HTTPS
                                 │ (Supabase API)
                                 │
                                 ▼
                          ┌──────────────┐
                          │  Supabase    │
                          │  Database    │
                          │              │
                          │  - PostgreSQL│
                          │  - REST API  │
                          │              │
                          │  ✅ 응답     │
                          └──────────────┘
```

---

## 🔄 실시간 동기화 상세 흐름

```
┌─────────────────────────────────────────────────────────┐
│  시나리오: 사용자 A가 주문 생성                          │
└─────────────────────────────────────────────────────────┘

┌─────────────┐
│  사용자 A    │
│  (기기 1)   │
└──────┬──────┘
       │
       │ [1] 주문 생성
       │     handleCreateOrder()
       │
       ▼
┌─────────────────────────────────────────────────────────┐
│  Frontend (기기 1)                                       │
│                                                         │
│  ┌─────────────────────────────────────────────────┐  │
│  │  1. 주문 객체 생성                               │  │
│  │     const order = {                             │  │
│  │       id: 'order_123',                          │  │
│  │       roomNo: '101',                            │  │
│  │       itemName: '물',                           │  │
│  │       ...                                       │  │
│  │     }                                           │  │
│  │                                                 │  │
│  │  2. 로컬 상태 업데이트                           │  │
│  │     setOrders([order, ...orders])              │  │
│  │     → UI 즉시 반영                              │  │
│  │                                                 │  │
│  │  3. localStorage 저장                          │  │
│  │     localStorage.setItem('hotelflow_orders',   │  │
│  │       JSON.stringify([order, ...orders]))      │  │
│  │                                                 │  │
│  │  4. WebSocket 전송                              │  │
│  │     socket.emit('hotelflow_sync', {            │  │
│  │       type: 'NEW_ORDER',                       │  │
│  │       payload: order,                          │  │
│  │       senderId: 'u1',                          │  │
│  │       sessionId: 'session_abc123',             │  │
│  │       timestamp: '2026-01-21T...'               │  │
│  │     })                                          │  │
│  └─────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
       │
       │ WebSocket 전송
       │ (wss://hotelworks-backend.onrender.com)
       │
       ▼
┌─────────────────────────────────────────────────────────┐
│  Render Server (hotelworks-backend.onrender.com)        │
│                                                         │
│  ┌─────────────────────────────────────────────────┐  │
│  │  server.js                                      │  │
│  │                                                 │  │
│  │  socket.on('hotelflow_sync', async (data) => { │  │
│  │    const { type, payload, senderId, sessionId }│  │
│  │                                                 │  │
│  │    // [2] 데이터베이스 저장                     │  │
│  │    if (type === 'NEW_ORDER') {                 │  │
│  │      await OrderModel.create(orderData)        │  │
│  │    }                                           │  │
│  │                                                 │  │
│  │    // [3] 브로드캐스트                          │  │
│  │    io.emit('hotelflow_sync', {                 │  │
│  │      type,                                     │  │
│  │      payload,                                  │  │
│  │      senderId,                                 │  │
│  │      sessionId,  // ✅ 포함                     │  │
│  │      timestamp                                 │  │
│  │    })                                          │  │
│  │  })                                            │  │
│  └─────────────────────────────────────────────────┘  │
│         │                                               │
│         │ HTTP/HTTPS                                    │
│         │                                               │
│         ▼                                               │
│  ┌─────────────────────────────────────────────────┐  │
│  │  Supabase Database                              │  │
│  │                                                 │  │
│  │  INSERT INTO orders (...)                      │  │
│  │  VALUES (...);                                 │  │
│  │                                                 │  │
│  │  ✅ 저장 완료                                   │  │
│  └─────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
       │
       │ WebSocket 브로드캐스트
       │ (모든 연결된 클라이언트)
       │
       ├──────────────┬──────────────┬──────────────┐
       │              │              │              │
       ▼              ▼              ▼              ▼
┌──────────┐   ┌──────────┐   ┌──────────┐   ┌──────────┐
│ 사용자 A  │   │ 사용자 B  │   │ 사용자 C  │   │ 사용자 D  │
│ (기기 1) │   │ (기기 2) │   │ (기기 3) │   │ (기기 4) │
│          │   │          │   │          │   │          │
│ [4] 수신 │   │ [4] 수신 │   │ [4] 수신 │   │ [4] 수신 │
│          │   │          │   │          │   │          │
│ socket.on│   │ socket.on│   │ socket.on│   │ socket.on│
│ ('hotel- │   │ ('hotel- │   │ ('hotel- │   │ ('hotel- │
│ flow_    │   │ flow_    │   │ flow_    │   │ flow_    │
│ sync')   │   │ sync')   │   │ sync')   │   │ sync')   │
│          │   │          │   │          │   │          │
│ [5] 확인 │   │ [5] 확인 │   │ [5] 확인 │   │ [5] 확인 │
│          │   │          │   │          │   │          │
│ senderId │   │ senderId │   │ senderId │   │ senderId │
│ === 'u1'│   │ === 'u2'│   │ === 'u3'│   │ === 'u4'│
│ &&       │   │          │   │          │   │          │
│ sessionId│   │          │   │          │   │          │
│ ===      │   │          │   │          │   │          │
│ 'session_│   │          │   │          │   │          │
│ abc123'  │   │          │   │          │   │          │
│          │   │          │   │          │   │          │
│ → 자신의 │   │ → 다른   │   │ → 다른   │   │ → 다른   │
│   메시지 │   │   사용자 │   │   사용자 │   │   사용자 │
│          │   │          │   │          │   │          │
│ [6] 처리 │   │ [6] 처리 │   │ [6] 처리 │   │ [6] 처리 │
│          │   │          │   │          │   │          │
│ - UI     │   │ - UI     │   │ - UI     │   │ - UI     │
│   업데이트│   │   업데이트│   │   업데이트│   │   업데이트│
│   (스킵) │   │   (추가) │   │   (추가) │   │   (추가) │
│          │   │          │   │          │   │          │
│ - 알림   │   │ - 알림   │   │ - 알림   │   │ - 알림   │
│   스킵   │   │   표시 ✅ │   │   표시 ✅ │   │   표시 ✅ │
│          │   │          │   │          │   │          │
│ - 사운드 │   │ - 사운드 │   │ - 사운드 │   │ - 사운드 │
│   스킵   │   │   재생 ✅ │   │   재생 ✅ │   │   재생 ✅ │
└──────────┘   └──────────┘   └──────────┘   └──────────┘
```

---

## 🔧 환경 변수 흐름

```
┌─────────────────────────────────────────────────────────┐
│  환경 변수 설정                                          │
└─────────────────────────────────────────────────────────┘

┌──────────────┐
│  Vercel      │
│  (Frontend)  │
│              │
│  Environment │
│  Variables:  │
│              │
│  ✅ SUPABASE_URL                                        │
│  ✅ SUPABASE_ANON_KEY                                   │
│  ✅ SUPABASE_SERVICE_ROLE_KEY                           │
│  ✅ VITE_WS_SERVER_URL                                  │
│     = wss://hotelworks-backend.onrender.com            │
│              │
│  → 빌드 시 주입                                         │
│  → import.meta.env.VITE_WS_SERVER_URL                  │
└──────────────┘
       │
       │
       ▼
┌──────────────┐
│  Render      │
│  (Backend)   │
│              │
│  Environment │
│  Variables:  │
│              │
│  ✅ NODE_ENV = production                              │
│  ✅ SUPABASE_URL                                        │
│  ✅ SUPABASE_ANON_KEY                                   │
│  ✅ SUPABASE_SERVICE_ROLE_KEY                           │
│  ✅ SERVER_URL                                          │
│     = https://hotelworks-backend.onrender.com          │
│  ✅ WS_SERVER_URL                                       │
│     = wss://hotelworks-backend.onrender.com            │
│              │
│  → process.env.SUPABASE_URL                            │
│  → process.env.SUPABASE_SERVICE_ROLE_KEY               │
└──────────────┘
       │
       │
       ▼
┌──────────────┐
│  Supabase    │
│  (Database)  │
│              │
│  Project     │
│  Settings:   │
│              │
│  ✅ Project URL                                         │
│     = https://pnmkclrwmbmzrocyygwq.supabase.co         │
│  ✅ API Keys                                            │
│     - anon key                                          │
│     - service_role key                                  │
│              │
│  → 환경 변수로 설정                                     │
└──────────────┘
```

---

## 📱 사용자 접속 흐름

```
┌─────────────────────────────────────────────────────────┐
│  사용자 접속 시퀀스                                      │
└─────────────────────────────────────────────────────────┘

[1] 브라우저에서 https://hotelworks.kr 접속
    │
    ▼
[2] Vercel CDN에서 React 앱 다운로드
    │
    ▼
[3] React 앱 초기화
    │
    ├─ [3-1] WebSocket URL 결정
    │   │
    │   ├─ 1순위: VITE_WS_SERVER_URL (환경 변수)
    │   ├─ 2순위: localStorage
    │   └─ 3순위: 도메인 기반
    │
    └─ [3-2] Socket.IO 연결
        │
        └─ wss://hotelworks-backend.onrender.com
            │
            ▼
[4] Render 서버 연결
    │
    ├─ [4-1] WebSocket 핸드셰이크
    │
    ├─ [4-2] 연결 성공
    │   │
    │   └─ socket.on('connect')
    │       │
    │       ├─ [4-2-1] 사용자 목록 요청
    │       │   socket.emit('request_all_users')
    │       │
    │       └─ [4-2-2] 주문 목록 요청 (로그인 시)
    │           socket.emit('request_all_orders')
    │
    └─ [4-3] 서버 응답
        │
        ├─ [4-3-1] 사용자 목록 수신
        │   socket.on('all_users_response')
        │
        └─ [4-3-2] 주문 목록 수신
            socket.on('all_orders_response')
            │
            └─ UI 업데이트
                │
                ▼
[5] 로그인 화면 표시
    │
    ├─ 사용자 목록 표시
    │
    └─ 로그인 버튼
        │
        ▼
[6] 로그인
    │
    ├─ [6-1] 사용자 선택
    │
    ├─ [6-2] 비밀번호 입력
    │
    └─ [6-3] 로그인 처리
        │
        ├─ 로컬 검증
        │
        └─ 로그인 상태 설정
            │
            ▼
[7] 메인 화면 표시
    │
    ├─ 주문 목록 표시
    │
    ├─ WebSocket 연결 유지
    │
    └─ 실시간 동기화 준비 완료
```

---

## 🔄 전체 시스템 상호작용 다이어그램

```
                    ┌─────────────────┐
                    │   GitHub        │
                    │   (소스 코드)    │
                    └────────┬────────┘
                             │
                ┌────────────┼────────────┐
                │            │            │
                ▼            ▼            ▼
        ┌───────────┐  ┌───────────┐  ┌───────────┐
        │  Vercel   │  │  Render   │  │  Supabase │
        │           │  │           │  │           │
        │ Frontend  │  │ Backend   │  │ Database  │
        └─────┬─────┘  └─────┬─────┘  └─────┬─────┘
              │              │              │
              │              │              │
              │              │              │
              └──────┬───────┴──────┬───────┘
                     │              │
                     │              │
                     ▼              ▼
              ┌──────────────┐  ┌──────────────┐
              │   사용자     │  │   사용자     │
              │   (기기 1)   │  │   (기기 2)   │
              └──────────────┘  └──────────────┘
                     │              │
                     │              │
                     └──────┬───────┘
                            │
                            │ WebSocket
                            │
                            ▼
                    ┌──────────────┐
                    │  실시간       │
                    │  동기화       │
                    └──────────────┘
```

---

## 📋 핵심 포인트 요약

### 1. **GitHub**
- 소스 코드 저장소
- 버전 관리
- 자동 배포 트리거

### 2. **Vercel**
- Frontend 호스팅
- React 앱 빌드 및 배포
- CDN을 통한 빠른 전송
- 환경 변수 주입

### 3. **Render**
- Backend 서버 호스팅
- WebSocket 서버 실행
- REST API 제공
- 환경 변수 주입

### 4. **Supabase**
- PostgreSQL 데이터베이스
- REST API 제공
- Row Level Security (RLS)
- 실시간 구독 (선택적)

### 5. **실시간 동기화**
- WebSocket을 통한 양방향 통신
- 모든 기기에서 즉시 반영
- 데이터베이스에 영구 저장
- 오프라인 지원

---

**이 다이어그램으로 전체 시스템의 구조와 흐름을 이해할 수 있습니다!** 🎯
