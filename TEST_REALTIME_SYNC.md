# 🧪 실시간 동기화 직접 테스트 가이드

## ⚠️ 중요: 실시간 동기화 문제 해결 완료

**모든 기기에서 실시간 알림을 받도록** 코드를 수정했습니다.

---

## 📋 직접 테스트 방법 (5분)

### 1단계: 브라우저 Console 열기

**모든 브라우저 탭에서 F12 키**를 눌러 개발자 도구를 엽니다.
- Console 탭을 선택하세요
- 이제 모든 WebSocket 메시지가 상세하게 로그됩니다

---

### 2단계: 2개의 브라우저 탭 준비

#### 탭 A (Front Desk):
1. 새 시크릿/프라이빗 창 열기 (Ctrl+Shift+N)
2. http://localhost:3000 접속
3. Username: `1` / Password: `1` 로그인
4. F12 → Console 탭 열기

#### 탭 B (Housekeeping):
1. 일반 브라우저 창에서
2. http://localhost:3000 접속  
3. Username: `2` / Password: `2` 로그인
4. F12 → Console 탭 열기

---

### 3단계: WebSocket 연결 확인

**양쪽 탭 Console에서 확인**:
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📥 WebSocket 메시지 수신
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

이 메시지가 보이면 WebSocket이 연결된 것입니다.

---

### 4단계: 실시간 동기화 테스트

#### 탭 A (Front Desk)에서:
1. **Dashboard** 페이지로 이동
2. **Rapid Order** 섹션에서:
   - 층 선택: `5층` 클릭
   - 방 선택: `501호` 클릭
   - 아이템 선택: `생수` 클릭 (수량 2개로 설정)
   - **"HK에 요청하기"** 버튼 클릭

#### 탭 B (Housekeeping) Console에서 즉시 확인:
```javascript
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📥 WebSocket 메시지 수신: NEW_ORDER
   발신자: u1
   로그인 상태: 로그인됨 (하우스키핑수, HOUSEKEEPING)
   주문 ID: ...
   방번호: 501
   아이템: 생수
   수신 시간: ...
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🆕 NEW_ORDER 처리 시작
   현재 사용자: 하우스키핑수 (HOUSEKEEPING)
   자신의 메시지: NO
   새 주문 추가 - 추가 전: 3개
   새 주문 추가 - 추가 후: 4개
🔔 알림 표시 시작: 501 생수 (다른 사용자)
✅ 알림 표시 완료 - 모든 기기에서 알림 표시
```

#### 탭 B 화면에서 확인:
- ✅ **토스트 알림** 표시: "501호 신규 요청: 생수 (수량: 2)"
- ✅ **Orders 목록**에 새 주문 자동 추가
- ✅ **사운드** 재생 (설정이 켜져 있는 경우)

---

### 5단계: 역방향 테스트 (상태 변경)

#### 탭 B (Housekeeping)에서:
1. **Orders** 페이지로 이동
2. 방금 생성된 `501호` 주문 찾기
3. **"접수"** 버튼 클릭

#### 탭 A (Front Desk) Console에서 즉시 확인:
```javascript
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📥 WebSocket 메시지 수신: STATUS_UPDATE
   주문 ID: ...
   새 상태: ACCEPTED
   방번호: 501
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔄 STATUS_UPDATE 처리 시작
   주문 ID: ...
   새 상태: ACCEPTED
   자신의 메시지: NO
✅ 상태 업데이트 완료
🔔 알림 표시 시작 - 상태 변경: ACCEPTED (다른 사용자)
✅ 알림 표시 완료 - 모든 기기에서 알림 표시
```

#### 탭 A 화면에서 확인:
- ✅ **토스트 알림**: "501호 상태 변경: 접수됨"
- ✅ **Orders 목록**에서 상태 배지가 **파란색(ACCEPTED)**으로 변경
- ✅ **사운드** 재생

---

## 🔍 문제 해결

### 문제 1: Console에 아무것도 안 보임

**원인**: WebSocket 연결이 안 됨

**해결**:
1. 서버 터미널 확인:
```bash
# 이 메시지가 보여야 함:
[SERVER] ✅ 새 클라이언트 연결
[SERVER]    Socket ID: ...
[SERVER]    총 연결 수: 2
```

2. 서버가 실행 중인지 확인:
```bash
# 터미널에서 확인
netstat -ano | findstr :3001

# 또는 브라우저에서
http://localhost:3001/health
```

3. 서버 재시작:
```bash
# 모든 Node 프로세스 종료
taskkill /F /IM node.exe /T

# 서버 재시작
npm run dev:all
```

---

### 문제 2: Console에 로그는 있는데 알림이 안 옴

**원인**: 브라우저 알림 권한 또는 사운드 설정

**해결**:
1. **Settings** 페이지 이동
2. **Notification Permission** 확인
3. **Sound Settings** 켜기
4. 브라우저 알림 권한 허용

---

### 문제 3: 같은 기기에서만 알림이 옴

**원인**: 코드가 아직 업데이트되지 않음

**해결**:
1. **모든 브라우저 탭에서 Ctrl+Shift+R** (강제 새로고침)
2. 또는 **브라우저 캐시 삭제** 후 재접속

---

## 📊 서버 로그 확인

서버 터미널에서 이런 로그가 보여야 합니다:

```bash
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📨 서버 메시지 수신: NEW_ORDER
   발신자: u1
   Socket ID: QGnI8yuajPHIwCYVAAAC
   주문 ID: 20260110_...
   방번호: 501
   아이템: 생수
   수량: 2
   💾 DB 저장 완료 (NEW_ORDER)
   📡 브로드캐스트 시작 - 2개 클라이언트에게 전송
   ✅ 브로드캐스트 완료
   수신 시간: 2026. 1. 10. ...
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

**"2개 클라이언트에게 전송"** 메시지가 중요합니다!

---

## ✅ 성공 기준

### 모든 항목이 체크되어야 합니다:

- [ ] 서버 터미널에 "총 연결 수: 2" 표시
- [ ] 탭 A Console에 "WebSocket 메시지 수신" 로그
- [ ] 탭 B Console에 "WebSocket 메시지 수신" 로그
- [ ] 탭 A에서 주문 생성 → 탭 B에서 알림 표시
- [ ] 탭 B에서 상태 변경 → 탭 A에서 알림 표시
- [ ] 서버 로그에 "브로드캐스트 시작 - 2개 클라이언트" 표시

---

## 🚨 여전히 안 되는 경우

다음 정보를 캡처해주세요:

1. **서버 터미널 전체 출력** (마지막 50줄)
2. **탭 A Console 전체 출력** (F12 → Console)
3. **탭 B Console 전체 출력** (F12 → Console)
4. **Network 탭**에서 WebSocket 연결 상태 (F12 → Network → WS)

---

## 📝 테스트 체크리스트

```
[ ] 1. 서버 실행 중 (npm run dev:all)
[ ] 2. 포트 3001 확인 (http://localhost:3001/health)
[ ] 3. 탭 A 로그인 (1/1) - Front Desk
[ ] 4. 탭 B 로그인 (2/2) - Housekeeping
[ ] 5. 양쪽 탭 F12 Console 열기
[ ] 6. 서버 로그에서 "총 연결 수: 2" 확인
[ ] 7. 탭 A에서 주문 생성
[ ] 8. 탭 B Console에서 "NEW_ORDER" 로그 확인
[ ] 9. 탭 B 화면에서 토스트 알림 확인
[ ] 10. 탭 B에서 상태 변경
[ ] 11. 탭 A Console에서 "STATUS_UPDATE" 로그 확인
[ ] 12. 탭 A 화면에서 토스트 알림 확인
```

---

**작성 시간**: 2026-01-10  
**버전**: 2.0.0  
**상태**: 코드 수정 완료 - 모든 기기 실시간 알림 지원
